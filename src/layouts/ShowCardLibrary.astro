---
import type { LinkSlice } from "../components/svelte/type";
import LogoLib from "../components/svelte/LogoLib.svelte";
import LinkBox from "../components/svelte/LinkBox.svelte";

interface Props {
  id: number;
  title: string;
  description: string;
  fw: ("svelte" | "vuejs" | "react")[];
  linkSlice: LinkSlice[][];
}

const { title, description, fw, linkSlice, id } = Astro.props;
---

<section
  id={"lib" + id}
  class="h-fit bg-linear-to-br from-neutral-300/30 to-neutral-500/30 rounded-md m-2 p-2 backdrop-blur-md"
>
  <div class="flex justify-between items-center mb-1">
    <h3 class="text-2xl font-semibold">{title}</h3>
    <button
      class="return flex justify-center items-center bg-red-800 border border-red-500 p-2 rounded-2xl text-white hover:bg-red-200 hover:text-red-800 duration-100"
    >
      <p>Retour â¤¾</p>
    </button>
  </div>
  <div
    class="relative flex flex-col justify-center items-center w-full bg-linear-to-br from-neutral-900/70 to-neutral-950/30 rounded-md p-10"
  >
    <div
      class="switch absolute flex flex-col items-center left-12 top-1/2 -translate-1/2"
    >
      {
        fw.map((elem) => (
          <div data-fw={elem}>
            <LogoLib name={elem} mode="no-link" />
          </div>
        ))
      }
    </div>
    <div class="slotCard">
      <slot />
    </div>
  </div>
  <div class="flex items-center">
    <p class="text-xl w-3/5">
      {description}
    </p>
    <div
      class="p-2 mt-2 w-2/5 flex flex-col items-start border-s-2 border-black"
    >
      <h5 class="text-2xl">Compatible avec</h5>
      <div class="flex flex-col justify-center my-3 space-y-2">
        {
          fw.map((item, i) => (
            <div class="flex items-center space-x-2">
              <LogoLib
                name={item}
                mode="no-link"
                classL={"h-[2.5em] w-[2.5em] mx-2.5"}
              />
              <LinkBox tabLink={linkSlice[i]} spanLink={false} />
            </div>
          ))
        }
      </div>
    </div>
  </div>
</section>
<script>
  import { currentSelect } from "../assets/ts/nano";
  import { makeVisible } from "../assets/ts/misc";

  const fwP = ["svelte", "vuejs", "react"];

  currentSelect.listen((val) => {
    const cardId = document.getElementById(`lib${val}`);
    if (cardId) {
      const switchFw = cardId.querySelector(".switch");
      const returnBtn = cardId.querySelector(".return");
      const slotCard = cardId.querySelector(".slotCard");

      returnBtn.addEventListener("click", () => {
        currentSelect.set(null);
      });

      for (let btnFw of switchFw.children) {
        const fw = btnFw.dataset.fw;
        btnFw.addEventListener("click", () => {
          for (let slot of slotCard.children) {
            console.log(fw,slot.classList.contains(fw),slot);
            
            makeVisible(slot.classList.contains(fw), slot);
          }
        });
      }
    }
  });
</script>
